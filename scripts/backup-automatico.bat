@echo off
REM backup-automatico.bat - Backup AutomÃ¡tico Git Silencioso (Windows)
REM Sistema: Assistente Pessoal IA

setlocal enabledelayedexpansion

set TIPO=%1
if "%TIPO%"=="" set TIPO=manual

REM Verificar se Git estÃ¡ inicializado
if not exist ".git" (
    echo âš ï¸  Git nÃ£o inicializado. Execute: git init
    exit /b 1
)

REM Verificar se hÃ¡ mudanÃ§as
git diff --quiet >nul 2>&1
if %ERRORLEVEL%==0 (
    git diff --cached --quiet >nul 2>&1
    if !ERRORLEVEL!==0 (
        REM Nenhuma mudanÃ§a
        exit /b 0
    )
)

REM Contar arquivos modificados
for /f %%i in ('git status --porcelain ^| find /c /v ""') do set ARQUIVOS_MOD=%%i

REM Ler estatÃ­sticas do cache
set CONVERSAS=0
set STREAK=0
if exist ".assistant-core\data\dashboard-cache.yaml" (
    for /f "tokens=2" %%i in ('findstr "conversas_total:" ".assistant-core\data\dashboard-cache.yaml" 2^>nul') do set CONVERSAS=%%i
    for /f "tokens=2" %%i in ('findstr "^streak_dias:" ".assistant-core\data\dashboard-cache.yaml" 2^>nul') do set STREAK=%%i
)

REM Criar mensagem de commit
set TIMESTAMP=%date% %time:~0,5%

REM Add e commit
git add -A >nul 2>&1
git commit -m "âœ… Backup automÃ¡tico: %TIPO% - Data: %TIMESTAMP% - Arquivos: %ARQUIVOS_MOD% - Status: %CONVERSAS% conversas, Streak: %STREAK% dias - ğŸ¤– Generated by Assistente Pessoal IA" --quiet >nul 2>&1

REM Push assÃ­ncrono se remoto configurado
git remote | findstr "origin" >nul 2>&1
if %ERRORLEVEL%==0 (
    start /b git push origin main --quiet >nul 2>&1
)

REM Feedback visual
echo ğŸ’¾ Backup automÃ¡tico feito Ã s %time:~0,5% âœ“

endlocal
