# Story 6.4: Testes E2E Cursor

**ID:** STORY-6.4
**Epic:** [Epic 6 - Suporte ao Cursor IDE](../epics/epic-6.md)
**Status:** Planejado
**Prioridade:** Média
**Estimativa:** 3 horas
**Depende de:** Story 6.3

---

## Descrição

Criar suite de testes end-to-end validando instalação, geração de comandos e funcionalidade no Cursor.

## Testes a Criar

### 1. Teste de Instalação
```javascript
// test/e2e/cursor-installation.test.js
test('Install for Cursor creates correct structure', async () => {
  const testDir = await createTempDir();
  
  await installForCursor(testDir, ['organizador', 'secretaria']);
  
  expect(await fs.pathExists(path.join(testDir, '.cursor/commands'))).toBe(true);
  expect(await fs.pathExists(path.join(testDir, '.cursor/rules'))).toBe(true);
  
  const commands = await fs.readdir(path.join(testDir, '.cursor/commands'));
  expect(commands).toHaveLength(8); // 2 agents * 4 commands
});
```

### 2. Teste de Geração
```javascript
test('Generated commands have correct content', async () => {
  const generator = new CursorCommandGenerator();
  await generator.loadTemplates();
  
  const commands = await generator.generateAgentCommands('organizador');
  
  expect(commands[0].filename).toBe('organizador.md');
  expect(commands[0].content).toContain('Sofia');
  expect(commands[0].content).toContain('processar-despejo.md');
});
```

### 3. Teste de Dual Install
```javascript
test('Dual install creates both structures', async () => {
  const testDir = await createTempDir();
  
  await install(testDir, {
    installClaudeCode: true,
    installCursor: true,
    selectedAgents: ['organizador']
  });
  
  expect(await fs.pathExists(path.join(testDir, '.claude'))).toBe(true);
  expect(await fs.pathExists(path.join(testDir, '.cursor'))).toBe(true);
});
```

### 4. Teste de Migração
```javascript
test('Migration from v1.0.4 works', async () => {
  const testDir = await setupV104Structure();
  
  await migrate(testDir);
  
  // Should have both old and new
  expect(await fs.pathExists(path.join(testDir, '.claude'))).toBe(true);
  expect(await fs.pathExists(path.join(testDir, '.cursor'))).toBe(true);
});
```

---

## Critérios de Aceitação

- [ ] 4 testes E2E criados e passando
- [ ] Teste de instalação Cursor valida estrutura
- [ ] Teste de geração valida conteúdo
- [ ] Teste dual install funciona
- [ ] Teste de migração preserva dados
- [ ] CI/CD executa testes automaticamente

---

**Próxima Story:** [6.5 - Documentação](./6.5.story.md)
