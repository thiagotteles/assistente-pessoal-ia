# História 0.4: Framework de Testes Essenciais

## Status
Aprovado

## História
**Como um** desenvolvedor que quer validar que o sistema funciona,
**Eu quero** testes básicos automatizados sem complexidade excessiva,
**Para que** eu possa verificar funcionalidade sem overhead desnecessário.

## Critérios de Aceitação

1. Teste básico: cada um dos 5 agentes responde corretamente quando chamado
2. Teste de persistência: knowledge-base salva e recupera dados corretamente
3. Teste de estrutura: todos os arquivos e pastas necessários são criados
4. Script `test-basic.sh` executável que valida instalação completa
5. Testes focados em funcionalidade essencial - sem logs, métricas, ou analytics

## Tarefas / Subtarefas

- [ ] Tarefa 1: Expandir test-basic.sh existente (CA: 3, 4)
  - [ ] Avaliar test-basic.sh já criado na História 0.1
  - [ ] Adicionar testes de Knowledge-Base Manager da História 0.2
  - [ ] Adicionar testes de Agent Memory System da História 0.3
  - [ ] Expandir validação de estrutura para novos componentes
- [ ] Tarefa 2: Implementar testes de agentes (CA: 1)
  - [ ] Teste básico de resposta para /organizador
  - [ ] Teste básico de resposta para /secretaria
  - [ ] Teste básico de resposta para /arquiteto
  - [ ] Teste básico de resposta para /psicologo
  - [ ] Teste básico de resposta para /mentor
- [ ] Tarefa 3: Testes de persistência do Knowledge-Base Manager (CA: 2)
  - [ ] Teste de salvar_entrada() com dados válidos
  - [ ] Teste de recuperar_entrada() por ID
  - [ ] Teste de geração de referências [[]]
  - [ ] Teste de integridade de metadados YAML
- [ ] Tarefa 4: Testes de Agent Memory System (CA: 2)
  - [ ] Teste de carregar_memoria_agente() para cada agente
  - [ ] Teste de atualizar_memoria_agente() com nova interação
  - [ ] Teste de persistência de memória entre sessões
  - [ ] Teste de backup e recovery de memória
- [ ] Tarefa 5: Testes de integração entre componentes (CA: 1, 2)
  - [ ] Teste de integração Knowledge-Base ↔ Agent Memory
  - [ ] Teste de sincronização de referências [[]] entre sistemas
  - [ ] Teste de carregamento de agente com memória + knowledge-base
  - [ ] Validação de consistência de dados entre sistemas
- [ ] Tarefa 6: Script de validação completa (CA: 4, 5)
  - [ ] Consolidar todos os testes em test-basic.sh
  - [ ] Implementar relatório de status consolidado
  - [ ] Adicionar validação de performance básica (sem analytics)
  - [ ] Criar script de recuperação para falhas de teste
- [ ] Tarefa 7: Testes de compatibilidade com Obsidian (CA: 3)
  - [ ] Validar se knowledge-base/ é vault válido
  - [ ] Testar abertura automática no Obsidian
  - [ ] Verificar se links [[]] funcionam corretamente
  - [ ] Validar configurações .obsidian/*

## Notas para Desenvolvimento

### Insights de Histórias Anteriores
[Fonte: docs/stories/0.1.story.md, 0.2.story.md - Registro do Agente de Desenvolvimento]
✅ **test-basic.sh já Existe**: Script básico criado na História 0.1 com testes de estrutura
✅ **Knowledge-Base Manager Implementado**: Sistema completo na História 0.2 precisa de testes
✅ **Agent Memory System**: História 0.3 implementará sistema que precisa ser testado
✅ **Estrutura Completa**: Sistema base instalado e configurado

### Requisitos de Estrutura do Projeto
[Fonte: architecture/estrutura-de-arquivos-source-tree.md]
- **test-basic.sh**: Script existente no root do projeto para expansão
- **.assistant-core/**: Diretório com módulos para teste (knowledge_base_manager.py, agent_memory_system.py)
- **knowledge-base/**: Vault Obsidian para testes de persistência
- **Scripts de teste**: Simplicidade máxima, sem frameworks complexos

### Stack Tecnológico
[Fonte: architecture/tech-stack.md]
- **Bash/Shell Scripts**: Framework de teste principal (test-basic.sh)
- **Python básico**: Testes de módulos Python via imports simples
- **Sistema de arquivos**: Validação de estrutura via comandos shell
- **Obsidian**: Validação de compatibilidade de vault
- **Git**: Verificação de integridade do repositório

### Especificações de Componentes para Teste
[Fonte: architecture/componentes.md]
**Componentes que devem ser testados:**
- **Knowledge-Base Manager**: Todas as 6 interfaces principais
- **Agent Memory System**: Todas as 6 interfaces de memória
- **Sistema de 5 Agentes**: Resposta básica de cada agente via slash command
- **Obsidian Integration**: Compatibilidade de vault e referências [[]]

### Filosofia de Testes do Projeto
[Fonte: docs/prd/epic-0-environment-setup-foundation.md]
- **Foco em funcionalidade essencial**: Sem logs, métricas, ou analytics
- **Testes básicos automatizados**: Verificação de funcionamento, não performance
- **Sem overhead desnecessário**: Scripts shell simples, sem frameworks pesados
- **Validação de instalação**: Garantir que sistema funciona após setup
- **Recuperação rápida**: Identificar e corrigir problemas básicos

### Testes Específicos por Componente

#### Knowledge-Base Manager (História 0.2)
```bash
# Exemplo de teste a ser implementado
python -c "
from .assistant-core.knowledge_base_manager import create_knowledge_manager
kb = create_knowledge_manager()
result = kb.salvar_entrada('Teste', 'Conteúdo teste', source_agent='teste')
assert result is not None, 'Falha ao salvar entrada'
print('✅ Knowledge-Base Manager: OK')
"
```

#### Agent Memory System (História 0.3)
```bash
# Exemplo de teste a ser implementado
python -c "
from .assistant-core.agent_memory_system import AgentMemorySystem
ams = AgentMemorySystem()
memoria = ams.carregar_memoria_agente('organizador')
assert memoria is not None, 'Falha ao carregar memória'
print('✅ Agent Memory System: OK')
"
```

#### Testes de Integração Obsidian
```bash
# Verificar se é vault válido
if [ -d "knowledge-base/.obsidian" ]; then
    echo "✅ Obsidian vault: OK"
else
    echo "❌ Obsidian vault: FALHA"
fi
```

### Convenções de Codificação para Testes
[Fonte: architecture/padres-de-codificao.md]
- **Scripts em inglês**: Comandos e nomes de função
- **Mensagens em português**: Output para usuário final
- **Encoding UTF-8**: Suporte a caracteres especiais
- **Exit codes**: 0 para sucesso, 1 para falha
- **Logging mínimo**: Apenas essencial para debug

### Integração com Sistema Existente
**test-basic.sh atual (História 0.1):**
- Já testa estrutura de diretórios
- Já testa arquivos base
- Já testa configurações de agentes
- Já testa integração Obsidian básica

**Expansões necessárias:**
- Testes de funcionalidade dos módulos Python
- Testes de persistência e recuperação
- Testes de integração entre componentes
- Validação de slash commands dos agentes

### Testing
- **Abordagem**: Expansão incremental de test-basic.sh existente
- **Cobertura**: Funcionalidade básica de todos os componentes implementados
- **Performance**: Verificação básica sem métricas complexas
- **Compatibilidade**: Validação com Obsidian e sistema operacional
- **Recovery**: Scripts de correção para problemas identificados

## Log de Mudanças
| Data | Versão | Descrição | Autor |
|------|---------|-----------|-------|
| 2025-09-25 | 1.0 | História criada com contexto completo do Épico 0, assumindo risco de histórias anteriores não finalizadas | Bob (SM) |

## Registro do Agente de Desenvolvimento
*Esta seção será preenchida pelo agente de desenvolvimento durante a implementação*

### Modelo de Agente Usado
*A ser preenchido pelo agente de desenvolvimento*

### Referências de Log de Debug
*A ser preenchido pelo agente de desenvolvimento*

### Lista de Notas de Conclusão
*A ser preenchido pelo agente de desenvolvimento*

### Lista de Arquivos
*A ser preenchido pelo agente de desenvolvimento*

## Resultados do QA
*Resultados da revisão do Agente de QA serão adicionados aqui*