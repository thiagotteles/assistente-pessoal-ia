# Story 5.0: NPM Package e Instalador Interativo User-First

**Epic**: Epic 5 - NPM Package e Produção User-First
**Status**: 🔄 In Progress
**Prioridade**: Alta
**Estimativa**: 20 horas (~2.5 dias úteis)

**NOTA**: Esta story é o container do Epic 5. Veja `docs/prd/epic-5-npm-package-production.md` para breakdown detalhado em 8 sub-stories (5.1 a 5.8).

---

## 🎯 Objetivo

Transformar o Assistente Pessoal IA de projeto de desenvolvimento em **produto end-user**, com instalação NPM interativa similar ao BMAD method, permitindo seleção de agentes durante instalação e contribuição da comunidade via Pull Requests.

---

## 📋 Contexto

**Problema Atual**:
- Instalação complexa (`git clone` + setup manual)
- README focado em desenvolvedores
- 5 agentes instalados obrigatoriamente (sem flexibilidade)
- Comunidade não pode contribuir agentes facilmente

**Solução**:
- NPM package com `npx assistente-pessoal install`
- Instalador interativo com seleção de agentes (checkboxes)
- Monorepo com todos agentes (`src/agents/`)
- Community contribui via PR (workflow fork + PR)

**Referência**: BMAD method (`npx bmad-method install`)

---

## 👥 Persona

**Marina, 34 anos**
- Desenvolvedora Full-Stack com TDAH
- Confortável com terminal, mas quer simplicidade
- Quer valor imediato (< 5 minutos)
- Quote: *"Eu não quero aprender outro sistema. Só quero que funcione."*

---

## 📖 User Stories

### US 3.5.1: Instalação NPM Simples

**Como** usuário final
**Quero** instalar com `npx assistente-pessoal install`
**Para** não precisar fazer git clone e setup manual

**Critérios de Aceitação**:
- ✅ Comando `npx assistente-pessoal install` funciona
- ✅ Installer pergunta local de instalação (default: `~/assistente-ia`)
- ✅ Installer pergunta nome do usuário
- ✅ Instalação completa em < 2 minutos
- ✅ Feedback visual com spinners e emojis

---

### US 3.5.2: Seleção Interativa de Agentes

**Como** usuário
**Quero** escolher quais agentes instalar
**Para** ter apenas os relevantes para meu perfil

**Critérios de Aceitação**:
- ✅ Installer mostra lista de agentes disponíveis (checkbox)
- ✅ Organizador (Sofia) é obrigatório e pré-selecionado
- ✅ Agentes recomendados aparecem marcados por padrão
- ✅ Interface clara com ícones, descrições e categorias
- ✅ Apenas agentes selecionados são copiados para instalação

**Interface Esperada**:
```
🤖 Escolha seus Agentes Especializados

━━━ AGENTES OFICIAIS ━━━

  [X] 📊 Secretária
      Gestão executiva, agenda, status de projetos
      Recomendado para: Todos os perfis

  [ ] 🏗️  Arquiteto (Marcus)
      Consultoria técnica com confronto construtivo
      Recomendado para: Desenvolvedores, Tech Leads

  [X] 🧠 Psicólogo (Dr. Helena)
      Suporte emocional especializado para TDAH
      Recomendado para: Pessoas com TDAH

(Use ESPAÇO para selecionar, ENTER para confirmar)
```

---

### US 3.5.3: Gerenciamento Pós-Instalação

**Como** usuário
**Quero** adicionar/remover agentes depois da instalação
**Para** adaptar meu assistente às minhas necessidades

**Critérios de Aceitação**:
- ✅ `npx assistente-pessoal list` - listar agentes instalados
- ✅ `npx assistente-pessoal add <agente>` - adicionar agente
- ✅ `npx assistente-pessoal remove <agente>` - remover agente
- ✅ `npx assistente-pessoal available` - ver agentes disponíveis
- ✅ Feedback claro com confirmações e avisos

---

### US 3.5.4: Contribuição de Agentes pela Comunidade

**Como** desenvolvedor da comunidade
**Quero** contribuir um agente customizado
**Para** compartilhar com outros usuários

**Critérios de Aceitação**:
- ✅ Agentes da comunidade vivem em `src/agents/community/`
- ✅ Template de agente documentado (`CONTRIBUTING-AGENTS.md`)
- ✅ Workflow: fork → branch → PR → review → merge
- ✅ Agent registry (`agents.json`) validado automaticamente
- ✅ Agentes aprovados aparecem no instalador automaticamente

---

### US 3.5.5: README User-First

**Como** usuário descobrindo o projeto
**Quero** entender rapidamente o valor e como instalar
**Para** decidir se quero usar

**Critérios de Aceitação**:
- ✅ Hero section com tagline impactante
- ✅ Instalação em destaque (1 comando visível)
- ✅ Seção "Por que usar?" antes de "Como usar?"
- ✅ Benefícios TDAH explicados com empatia
- ✅ Screenshots/GIFs do instalador e interface

---

## 🏗️ Arquitetura Técnica

### Estrutura do Repositório (Monorepo)

```
assistente-pessoal-ia/
├── package.json                     # NPM package config
├── bin/
│   └── cli.js                       # npx entry point
├── src/
│   ├── installer/
│   │   ├── prompts.js               # Interactive prompts
│   │   ├── agent-selector.js        # Agent selection UI
│   │   └── setup.js                 # Installation logic
│   └── agents/
│       ├── agents.json              # ⭐ Agent registry
│       ├── core/
│       │   └── organizador/         # Required
│       ├── official/
│       │   ├── secretaria/
│       │   ├── arquiteto/
│       │   ├── psicologo/
│       │   └── mentor/
│       └── community/               # Community agents
│           ├── financeiro/
│           └── designer/
├── templates/                       # Base structure (no agents)
│   ├── despejo/
│   ├── knowledge-base/
│   └── .assistant/
│       └── agents/                  # Empty (populated during install)
└── docs/
    ├── CONTRIBUTING-AGENTS.md       # How to contribute agents
    └── UX-BRIEF-user-first.md       # UX guidelines
```

---

### Agent Registry (`src/agents/agents.json`)

```json
{
  "version": "1.0.0",
  "agents": {
    "core": [
      {
        "id": "organizador",
        "name": "Sofia",
        "title": "Organizador Inteligente",
        "icon": "📋",
        "description": "Processa despejo diário e organiza automaticamente",
        "required": true,
        "author": "oficial",
        "category": "essencial",
        "path": "src/agents/core/organizador"
      }
    ],
    "official": [
      {
        "id": "secretaria",
        "name": "Secretária",
        "icon": "📊",
        "description": "Gestão executiva, agenda, status de projetos",
        "required": false,
        "recommended": true,
        "path": "src/agents/official/secretaria"
      },
      // ... outros agentes oficiais
    ],
    "community": [
      {
        "id": "financeiro",
        "name": "Consultor Financeiro",
        "icon": "💰",
        "description": "Gestão de finanças pessoais",
        "author": "joao-dev",
        "author_github": "https://github.com/joao-dev",
        "path": "src/agents/community/financeiro"
      }
    ]
  }
}
```

---

## 💻 Implementação

### Fase 1: Core Installer (2-3 dias)

**Tarefas**:
1. Criar estrutura NPM package
   - `package.json` com `bin` entry point
   - `bin/cli.js` com commander.js
   - Dependencies: inquirer, chalk, ora, fs-extra

2. Implementar installer base
   - `src/installer/prompts.js` - perguntas básicas
   - `src/installer/setup.js` - cópia de arquivos
   - Feedback visual com spinners

3. Criar agent registry
   - `src/agents/agents.json` com metadados
   - Validação de schema JSON

4. Implementar agent selector
   - `src/installer/agent-selector.js`
   - Interface checkbox com inquirer
   - Recomendações baseadas em perfil

5. Adaptar setup para copiar apenas selecionados
   - Lógica de cópia seletiva
   - Validação de agentes instalados

**Deliverables**:
- ✅ `npx assistente-pessoal install` funcional
- ✅ Seleção interativa de agentes
- ✅ Instalação customizada

---

### Fase 2: CLI Commands (1-2 dias)

**Tarefas**:
1. Implementar `list` command
   - Ler `.assistant/agents/` instalados
   - Formatar output com ícones e descrições

2. Implementar `add <agent>` command
   - Validar agente existe no registry
   - Copiar para `.assistant/agents/`
   - Atualizar configuração

3. Implementar `remove <agent>` command
   - Validar agente está instalado
   - Confirmação antes de remover
   - Não permitir remover core agents

4. Implementar `available` command
   - Mostrar todos agentes do registry
   - Indicar quais já estão instalados
   - Separar por categorias

5. Implementar `info <agent>` command
   - Mostrar detalhes completos do agente
   - README do agente
   - Autor e categoria

**Deliverables**:
- ✅ CLI completo com 5 comandos
- ✅ Help messages claros
- ✅ Error handling robusto

---

### Fase 3: Community Workflow (1 dia)

**Tarefas**:
1. Criar `CONTRIBUTING-AGENTS.md`
   - Template de estrutura de agente
   - Workflow de contribuição (fork + PR)
   - Checklist de qualidade

2. Criar template de agente
   - `agent.yaml` template
   - `memory-template.yaml` template
   - `AUTHOR.md` template

3. Criar PR template para agentes
   - `.github/PULL_REQUEST_TEMPLATE/agent.md`
   - Checklist de review

4. CI validation
   - GitHub Action para validar `agents.json`
   - Validar estrutura de agentes
   - Check for duplicates

**Deliverables**:
- ✅ Documentação de contribuição completa
- ✅ Templates prontos para uso
- ✅ CI validando PRs automaticamente

---

### Fase 4: Migração de Agentes Existentes (1 dia)

**Tarefas**:
1. Mover agentes atuais
   - `.assistant-core/agents/organizador/` → `src/agents/core/organizador/`
   - `.assistant-core/agents/secretaria/` → `src/agents/official/secretaria/`
   - Arquiteto, Psicólogo, Mentor para `official/`

2. Registrar em `agents.json`
   - Adicionar metadados completos
   - Definir categorias
   - Marcar recomendações

3. Testar instalação seletiva
   - Instalar diferentes combinações
   - Validar slash commands funcionam
   - Testar add/remove de agentes

4. Update docs
   - Atualizar README principal
   - Criar screenshots do instalador
   - Atualizar USAGE.md

**Deliverables**:
- ✅ Todos agentes migrados
- ✅ Registry completo e validado
- ✅ Documentação atualizada

---

### Fase 5: UX Refinement (1 dia)

**Tarefas**:
1. Implementar feedback UX
   - Mensagens de erro amigáveis
   - Success messages motivacionais
   - Progress indicators claros

2. Criar README user-first
   - Hero section impactante
   - Instalação em destaque
   - Benefícios TDAH com empatia

3. Criar USAGE.md progressivo
   - Quick Start (5 min)
   - Guia Completo
   - FAQ

4. Screenshots e GIFs
   - Processo de instalação
   - Seleção de agentes
   - Comandos CLI

**Deliverables**:
- ✅ README user-first completo
- ✅ Documentação progressiva
- ✅ Assets visuais

---

## ✅ Acceptance Criteria (QA Gates)

### AC1: NPM Installation Works

```bash
$ npx assistente-pessoal install

# Expected:
✅ Interactive installer launches
✅ All prompts work correctly
✅ Agent selection shows all available agents
✅ Installation completes without errors
✅ Success message shows installed agents
```

**Test**: `test-story-3.5-install.sh`

---

### AC2: Agent Selection Works

```bash
# Expected:
✅ Organizador is pre-selected and disabled
✅ Recommended agents are checked by default
✅ Community agents appear in separate section
✅ Space toggles selection, Enter confirms
✅ Only selected agents are copied
```

**Test**: Manual + automated check of `.assistant/agents/` contents

---

### AC3: Post-Install Commands Work

```bash
$ npx assistente-pessoal list
✅ Shows installed agents with icons

$ npx assistente-pessoal available
✅ Shows all agents, marks installed ones

$ npx assistente-pessoal add arquiteto
✅ Adds agent successfully

$ npx assistente-pessoal remove secretaria
✅ Removes after confirmation
```

**Test**: `test-story-3.5-cli.sh`

---

### AC4: Community Contribution Works

```bash
# Expected workflow:
1. Fork repository
2. Create agent in src/agents/community/
3. Add to agents.json
4. Create PR
5. CI validates structure
6. After merge, agent appears in installer
```

**Test**: `test-story-3.5-community.sh` (validates structure)

---

### AC5: README is User-First

**Checklist**:
- ✅ Hero section in first 100 lines
- ✅ Installation command visible in first 200 lines
- ✅ "Por que usar?" before "Como usar?"
- ✅ TDAH benefits explained with empathy
- ✅ No git clone mentioned as primary install method
- ✅ Developer docs moved to CONTRIBUTING.md

**Test**: Manual review + readability metrics

---

## 📊 Success Metrics

**Installation**:
- ⏱️ Time to install: < 2 minutes (target)
- 📦 Installation size: < 20MB (only selected agents)
- 🎯 User completion rate: > 95%

**Adoption**:
- 📈 README bounce rate: < 30% (users read > 50%)
- ⭐ GitHub stars increase: +50% in 30 days
- 💬 Community PRs: At least 1 agent in 60 days

**Quality**:
- ✅ Zero installation errors in basic flow
- ✅ All commands work on Windows/Mac/Linux
- ✅ CI validates all agents before merge

---

## 🚧 Technical Dependencies

**NPM Packages Required**:
- `commander` - CLI framework
- `inquirer` - Interactive prompts
- `chalk` - Terminal colors
- `ora` - Spinners
- `fs-extra` - File operations
- `yaml` - YAML parsing

**Files to Create**:
- `bin/cli.js`
- `src/installer/prompts.js`
- `src/installer/agent-selector.js`
- `src/installer/setup.js`
- `src/agents/agents.json`
- `docs/CONTRIBUTING-AGENTS.md`

**Files to Modify**:
- `package.json` - add bin, dependencies
- `README.md` - complete rewrite (user-first)
- `docs/USAGE.md` - update with NPM install
- `.github/workflows/ci.yml` - add agent validation

---

## 🔗 Related Documents

- **Architecture**: `docs/architecture/agent-selector-monorepo.md`
- **UX Brief**: `docs/UX-BRIEF-user-first.md`
- **Current README**: `README.md` (to be replaced)
- **Setup Script**: `setup.sh` (to be deprecated)

---

## 📝 Notes

**Breaking Changes**:
- Installation method changes from `git clone` to `npx install`
- `.assistant-core/` moves to `src/agents/` in repository
- User installations still use `.assistant/` folder

**Migration Plan**:
- Keep `setup.sh` working for backward compatibility
- Add deprecation notice in setup.sh
- Document migration path in README

**Future Enhancements** (Post-v1.0):
- Agent presets ("developer bundle", "student bundle")
- `doctor` command for health checks
- Auto-update mechanism for agents
- Agent ratings/reviews from community

---

## ✅ Definition of Done

- ✅ All 5 user stories implemented
- ✅ All 5 QA gates pass
- ✅ `npx assistente-pessoal install` works on Win/Mac/Linux
- ✅ README is user-first and compelling
- ✅ CONTRIBUTING-AGENTS.md complete
- ✅ CI validates agent structure
- ✅ Existing users can upgrade via Story 3.0 script
- ✅ Zero BMAD-specific references (generalized)

---

**Estimated Effort**: 6-7 days
**Priority**: Alta (enables user-first transformation)
**Epic**: Epic 3 - Experiência e Sucesso do Usuário Final

---

**Created**: 2025-10-02
**Author**: Winston (Architect)
**Status**: 🔄 In Progress
