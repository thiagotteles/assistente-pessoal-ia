# História 0.3: Agent Memory System Foundation

## Status
Aprovado

## História
**Como um** sistema que precisa de agentes com personalidades consistentes,
**Eu quero** que cada agente mantenha memória e contexto entre interações,
**Para que** a experiência seja coerente e evolutiva.

## Critérios de Aceitação

1. Templates YAML funcionais para memória de cada um dos 5 agentes específicos
2. Métodos implementados: `carregar_memoria_agente()`, `atualizar_memoria_agente()`
3. Persistência automática de contexto, personalidade, e padrões aprendidos
4. Sistema de reset e backup de memória individual por agente
5. Carregamento automático de memória quando agente é ativado via slash command

## Tarefas / Subtarefas

- [ ] Tarefa 1: Implementar classe AgentMemorySystem core (CA: 1, 2)
  - [ ] Criar módulo AgentMemorySystem em .assistant-core/agent_memory_system.py
  - [ ] Definir interfaces obrigatórias conforme arquitetura de componentes
  - [ ] Implementar sistema de logging para operações de memória
  - [ ] Configurar integração com arquivos YAML de memória existentes
- [ ] Tarefa 2: Implementar métodos de carregamento e atualização (CA: 2, 3)
  - [ ] Método `carregar_memoria_agente()` - recupera contexto específico por agente
  - [ ] Método `atualizar_memoria_agente()` - atualiza memória com nova interação
  - [ ] Método `manter_personalidade()` - garante consistência comportamental
  - [ ] Persistência automática após cada atualização
- [ ] Tarefa 3: Sistema de padrões e aprendizado (CA: 3)
  - [ ] Método `identificar_padroes_referencias()` - detecta uso de [[]] links
  - [ ] Sistema de histórico de interações por agente
  - [ ] Aprendizado de preferências e contextos do usuário
  - [ ] Auto-evolução de personalidade baseada em feedback
- [ ] Tarefa 4: Sistema de backup e recovery (CA: 4)
  - [ ] Método `backup_memoria()` - backup automático de contexto
  - [ ] Método `reset_memoria_agente()` - reset individual por agente
  - [ ] Sistema de versionamento de memória por agente
  - [ ] Recovery automático em caso de corrupção de arquivo
- [ ] Tarefa 5: Integração com slash commands (CA: 5)
  - [ ] Carregamento automático quando agente é ativado via /comando
  - [ ] Hook de integração com sistema de agentes existente
  - [ ] Validação de integridade de memória no carregamento
  - [ ] Fallback para memória padrão em caso de erro
- [ ] Tarefa 6: Integração com Knowledge-Base Manager (CA: 2, 3)
  - [ ] Interface com KnowledgeBaseManager implementado na História 0.2
  - [ ] Compartilhamento de contexto entre agentes via knowledge-base
  - [ ] Sincronização de referências [[]] aprendidas
  - [ ] Evitar duplicação entre memória do agente e knowledge-base
- [ ] Tarefa 7: Validação e testes de integração (CA: 1-5)
  - [ ] Teste de carregamento de memória para todos os 5 agentes
  - [ ] Teste de persistência de contexto entre sessões
  - [ ] Teste de reset e recovery de memória corrompida
  - [ ] Validação de compatibilidade com templates YAML existentes

## Notas para Desenvolvimento

### Insights de Histórias Anteriores
[Fonte: docs/stories/0.2.story.md - Registro do Agente de Desenvolvimento]
✅ **Knowledge-Base Manager Disponível**: Sistema de persistência completo implementado com API interna
✅ **Templates YAML já Existem**: Arquivos de memória para todos os 5 agentes já criados na História 0.1
✅ **Estrutura de Agentes Configurada**: .assistant-core/memory/ com 5 arquivos específicos
✅ **Cross-Agent Intelligence Preparado**: Hooks básicos já configurados para integração

### Requisitos de Estrutura do Projeto
[Fonte: architecture/estrutura-de-arquivos-source-tree.md]
- **.assistant-core/memory/**: Diretório já existente com arquivos YAML por agente
  - organizador-memory.yaml, secretaria-memory.yaml, arquiteto-memory.yaml
  - psicologo-memory.yaml, mentor-memory.yaml
- **Integração com Knowledge-Base Manager**: Sistema já implementado em .assistant-core/knowledge_base_manager.py
- **Templates YAML**: Estrutura padronizada já definida nos arquivos existentes

### Stack Tecnológico
[Fonte: architecture/tech-stack.md]
- **Sistema 100% Local** - sem dependências de nuvem
- **YAML 1.2** - configurações e memória legíveis por humanos
- **Python** - linguagem principal para lógica de negócio
- **Claude Code** - interface principal para processamento IA
- **Pattern Recognition** - análise de padrões de uso e preferências

### Especificações de Componentes
[Fonte: architecture/componentes.md#agent-memory-system]
**Interfaces Principais Obrigatórias (TODAS devem ser implementadas):**
- `carregar_memoria_agente()` - Recupera contexto e personalidade para qualquer dos 5 agentes → Tarefa 2
- `atualizar_interacao()` - Registra nova interação e aprendizados por agente → Tarefa 2
- `manter_personalidade()` - Garante consistência comportamental específica → Tarefa 2
- `identificar_padroes_referencias()` - Detecta padrões de uso de [[]] → Tarefa 3
- `reset_memoria_agente()` - Reset individual quando necessário → Tarefa 4
- `backup_memoria()` - Backup de contexto para recovery → Tarefa 4

**Dependências:** .assistant-core/memory/, histórico de interações, Knowledge-Base Manager
**Stack:** YAML configs + Claude Code + pattern recognition

### Estrutura de Memória dos Agentes
[Fonte: Arquivos existentes em .assistant-core/memory/]
**Estrutura Atual dos Arquivos YAML:**
```yaml
# Exemplo baseado na estrutura existente
agent_id: organizador
personality_core:
  traits: []
  communication_style: ""
interaction_history:
  patterns: []
  preferences: []
learned_context:
  projects: []
  people: []
  decisions: []
```

### Convenções de Codificação Obrigatórias
[Fonte: architecture/padres-de-codificao.md]
- **Arquivos sempre .py para lógica**: AgentMemorySystem como módulo Python
- **YAML para dados**: Memórias persistidas em formato YAML 1.2
- **Encoding UTF-8**: Suporte completo caracteres português
- **Timestamps ISO**: Sempre formato YYYY-MM-DDTHH:MM:SS
- **Personalidade consistente**: Manutenção de características específicas por agente

### Integração com Agentes Existentes
[Fonte: architecture/componentes.md - Sistema de 5 Agentes]
**Agentes que precisam de memória (todos os 5):**
- **Organizador Agent**: Padrões de categorização, projetos frequentes, preferências de organização
- **Secretaria Agent**: Estilo de reuniões, pessoas importantes, padrões de agenda
- **Arquiteto Agent**: Decisões técnicas anteriores, padrões arquiteturais preferidos, contexto técnico
- **Psicólogo Agent**: Padrões emocionais do usuário, estratégias eficazes, histórico TDAH
- **Mentor Agent**: Metas de carreira, progresso, oportunidades identificadas, networking

### Testing
[Fonte: docs/prd/epic-0-environment-setup-foundation.md#story-04]
- **Foco funcionalidade essencial**: Sem logs, métricas, ou analytics desnecessários
- **Validação básica**: AgentMemorySystem carrega e persiste memória corretamente
- **Testes de integração**: Compatibilidade com templates YAML existentes
- **Teste manual por agente**: Verificar carregamento de cada um dos 5 agentes
- **Sem testes automatizados complexos**: Conforme padrão estabelecido no épico

## Log de Mudanças
| Data | Versão | Descrição | Autor |
|------|---------|-----------|-------|
| 2025-09-25 | 1.0 | História criada com contexto completo do Épico 0, assumindo risco de histórias anteriores não finalizadas | Bob (SM) |

## Registro do Agente de Desenvolvimento
*Esta seção será preenchida pelo agente de desenvolvimento durante a implementação*

### Modelo de Agente Usado
*A ser preenchido pelo agente de desenvolvimento*

### Referências de Log de Debug
*A ser preenchido pelo agente de desenvolvimento*

### Lista de Notas de Conclusão
*A ser preenchido pelo agente de desenvolvimento*

### Lista de Arquivos
*A ser preenchido pelo agente de desenvolvimento*

## Resultados do QA
*Resultados da revisão do Agente de QA serão adicionados aqui*